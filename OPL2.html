<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OPL2 – Lecteur PDN</title>

<style>
:root{
  --panel:#f3efe6;
  --border:#d8cfbf;
  --light:#efe4cf;
  --dark:#a8743a;
  --ink:#2b2b2b;
  --muted:#6b3f2c;
  --w:520px;
}

html,body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;color:var(--ink)}
body{background:#fff;display:flex;justify-content:center;padding:12px}

.wrap{width:var(--w);max-width:var(--w);display:flex;flex-direction:column;gap:10px}

.selectWrap{display:flex;gap:8px;align-items:center;font-size:13px;color:var(--muted)}
select{
  flex:1;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#fff;
  font-size:13px;
}

.score{
  text-align:center;
  font-size:13px;
  font-weight:800;
  color:var(--muted);
}
.score:empty{display:none;}

.board{
  width:100%;
  aspect-ratio:1/1;
  display:grid;
  grid-template-columns:repeat(10,1fr);
  grid-template-rows:repeat(10,1fr);
  outline:1px solid rgba(0,0,0,.12);
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 8px 30px rgba(0,0,0,.20);
}

.sq{position:relative;display:flex;align-items:center;justify-content:center}
.light{background:var(--light)}
.dark{background:var(--dark)}

.num{
  position:absolute;
  top:3px;
  left:5px;
  font-size:12px;
  font-weight:800;
  z-index:5;
  pointer-events:none;
  text-shadow:
    -1px 0 rgba(255,255,255,.9),
     1px 0 rgba(255,255,255,.9),
     0 -1px rgba(255,255,255,.9),
     0  1px rgba(255,255,255,.9),
     0  0 2px rgba(0,0,0,.3);
}
.dark .num{color:#fff}

.piece{
  width:72%;
  aspect-ratio:1/1;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow: inset 0 3px 0 rgba(255,255,255,.18), 0 6px 12px rgba(0,0,0,.35);
  border:1px solid rgba(0,0,0,.35);
  position:relative;
  z-index:2;
}
.w{background:#f6f1e8}
.b{background:#1a1a1a}
.king::after{
  content:"K";
  font-weight:800;
  font-size:18px;
  color:rgba(255,255,255,.85);
  text-shadow:0 1px 0 rgba(0,0,0,.6);
}
.w.king::after{color:rgba(0,0,0,.75);text-shadow:none}

.bar{
  display:flex;
  gap:6px;
  justify-content:center;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:8px;
  flex-wrap:wrap;
}
button{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid #cdbfa9;
  background:#fff;
  cursor:pointer;
  font-weight:800;
  min-width:44px;
}

.info{
  flex:1;
  text-align:center;
  font-size:12px;
  color:var(--muted);
}

.panel{
  background:#fff;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
}
.panel h3{margin:0 0 6px 0;font-size:13px;color:var(--muted)}

.msg{
  color:#b00020;
  font-size:12px;
  text-align:center;
  min-height:16px;
}
</style>
</head>

<body>
<div class="wrap">

<div class="selectWrap">
  <strong>Partie</strong>
  <select id="gameSel"></select>
</div>

<div id="score" class="score"></div>

<div id="board" class="board"></div>

<div class="bar">
  <button id="first">⏮</button>
  <button id="prev">⟵</button>
  <button id="play">▶︎</button>
  <button id="next">⟶</button>
  <button id="last">⏭</button>
  <div id="info" class="info"></div>
</div>

<div class="panel">
  <h3>Commentaire</h3>
  <div id="commentBox">—</div>
</div>

<div class="msg" id="msg"></div>

</div>

<script>
/* VERSION STABLE — modifications score + numéros uniquement */
(() => {

const pieces=new Map();
const board=document.getElementById("board");
const scoreEl=document.getElementById("score");
const gameSel=document.getElementById("gameSel");
const info=document.getElementById("info");
const commentBox=document.getElementById("commentBox");
const msg=document.getElementById("msg");

function rcFromN(n){
  const i=n-1,r=Math.floor(i/5),k=i%5;
  const c=(r%2===0)?(1+2*k):(0+2*k);
  return [r,c];
}
function nFromRC(r,c){
  if((r+c)%2===0)return null;
  const k=(r%2===0)?(c-1)/2:c/2;
  if(!Number.isInteger(k))return null;
  return r*5+k+1;
}

function renderBoard(){
  board.innerHTML="";
  for(let r=0;r<10;r++){
    for(let c=0;c<10;c++){
      const sq=document.createElement("div");
      const dark=(r+c)%2===1;
      sq.className="sq "+(dark?"dark":"light");
      if(dark){
        const n=nFromRC(r,c);
        const num=document.createElement("div");
        num.className="num";
        num.textContent=n;
        sq.appendChild(num);
        const p=pieces.get(n);
        if(p){
          const d=document.createElement("div");
          d.className="piece "+p.color+(p.king?" king":"");
          sq.appendChild(d);
        }
      }
      board.appendChild(sq);
    }
  }
}

function getTag(text,name){
  const re=new RegExp("^\\s*\\["+name+'\\s+"([^"]*)"\\]\\s*$',"mi");
  const m=text.match(re);
  return m?m[1]:"";
}

function updateScore(text){
  const r=getTag(text,"Result");
  if(!r||r==="*") scoreEl.textContent="";
  else scoreEl.textContent="Score : "+r;
}

/* Lecture simplifiée pour démo */
window.addEventListener("message",e=>{
  if(!e.data||e.data.type!=="OPL_PDN")return;
  const pdn=e.data.pdn||"";
  updateScore(pdn);
  msg.textContent="";
});

renderBoard();

})();
</script>
</body>
</html>
